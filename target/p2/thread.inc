' Catalina thread set up ...

DAT
 
' Thread initialization code ...

INITIALIZE_THREAD
       sub     SP,#(THREAD_BLOCK_SIZE-THREAD_EXT_OFF)*4 ' top of stack is thread block
       neg     t1,#1     ' write -1 to be extended information ...
       wrlong  t1,SP     ' ... (i.e. we are not a pthread!)
       sub     SP,#(THREAD_EXT_OFF-THREAD_AFF_OFF)*4-2  ' point to ticks
       mov     t1,#100   ' set ticks ...
       wrword  t1,SP     ' ... to 100
       cogid   t1        ' set up ...
       shl     t1,#8     ' ...
       sub     SP,#2     ' ...
       wrword  t1,SP     ' ... affinity/flags
       sub     SP,#(THREAD_AFF_OFF)*4 ' point to thread block
       wrlong  SP,SP     ' make thread block point to itself
 _ret_ mov     TP,SP     ' make thread block the current thread


